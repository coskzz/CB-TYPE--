<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ“ã‚¸ãƒã‚¹5ã¤ã®å‹ è¨ºæ–­</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --primary:#6C5CE7;--primary-light:#8B7CF6;--accent:#00A86B;
  --bg:#F7F8FC;--surface:#FFFFFF;--surface2:#F0F2F8;
  --border:#E2E8F0;--text:#1A1A2E;--text-sub:#64748B;
  --reporter:#DC2626;--arbitrage:#0891B2;--collab:#D97706;
  --prosumer:#7C3AED;--uber:#DB2777;
  --radius:16px;--shadow:0 2px 16px rgba(0,0,0,.07);
}
html{font-size:16px;scroll-behavior:smooth}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
  background:var(--bg);color:var(--text);min-height:100dvh;
  display:flex;flex-direction:column;align-items:center;
  overflow-x:hidden;line-height:1.7;
}

.container{
  position:relative;z-index:1;width:100%;max-width:680px;
  padding:24px 20px 60px;
}

/* â”€â”€ Header â”€â”€ */
header{text-align:center;padding:40px 0 32px}
header h1{
  font-size:1.6rem;font-weight:800;letter-spacing:.02em;
  color:var(--primary);
}
header p{margin-top:8px;color:var(--text-sub);font-size:.9rem}

/* â”€â”€ Progress bar â”€â”€ */
.progress-wrap{
  position:sticky;top:0;z-index:10;
  background:rgba(247,248,252,.9);backdrop-filter:blur(12px);
  padding:14px 0 10px;margin-bottom:16px;
  border-bottom:1px solid var(--border);
}
.progress-bar{
  height:6px;border-radius:3px;background:var(--surface2);overflow:hidden;
}
.progress-fill{
  height:100%;width:0%;border-radius:3px;
  background:linear-gradient(90deg,var(--primary),var(--accent));
  transition:width .4s ease;
}
.progress-label{
  text-align:right;font-size:.75rem;color:var(--text-sub);margin-top:4px;
}

/* â”€â”€ Card / Question â”€â”€ */
.card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:32px 28px;
  box-shadow:var(--shadow);
  animation:fadeUp .45s ease both;
}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(24px)}
  to{opacity:1;transform:translateY(0)}
}
.card.hidden{display:none}
.q-number{
  font-size:.75rem;font-weight:700;color:var(--accent);
  text-transform:uppercase;letter-spacing:.1em;margin-bottom:8px;
}
.q-text{font-size:1.15rem;font-weight:700;margin-bottom:24px;color:var(--text)}

/* â”€â”€ Options â”€â”€ */
.options{display:flex;flex-direction:column;gap:12px}
.opt-btn{
  display:flex;align-items:center;gap:14px;
  background:var(--surface2);border:2px solid var(--border);
  border-radius:12px;padding:16px 20px;
  color:var(--text);font-size:.95rem;text-align:left;
  cursor:pointer;transition:all .2s ease;
  line-height:1.5;
}
.opt-btn:hover{
  border-color:var(--primary);
  background:rgba(108,92,231,.05);
  transform:translateX(4px);
}
.opt-btn .icon{
  flex-shrink:0;width:36px;height:36px;border-radius:10px;
  display:grid;place-items:center;font-size:1.1rem;
  background:rgba(108,92,231,.08);
}
.opt-btn:hover .icon{background:rgba(108,92,231,.15)}

/* â”€â”€ Intro & screens â”€â”€ */
.screen{text-align:center}
.screen.hidden{display:none}

.start-btn{
  display:inline-flex;align-items:center;gap:8px;
  margin-top:28px;padding:16px 40px;
  border:none;border-radius:60px;font-size:1rem;font-weight:700;
  cursor:pointer;transition:all .25s ease;
  color:#fff;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  box-shadow:0 4px 24px rgba(108,92,231,.3);
}
.start-btn:hover{transform:translateY(-2px);box-shadow:0 6px 32px rgba(108,92,231,.45)}

/* â”€â”€ Transition screen â”€â”€ */
.transition-screen{
  text-align:center;padding:60px 24px;
}
.transition-screen .check{
  font-size:3rem;margin-bottom:20px;
  animation:popIn .4s ease both;
}
@keyframes popIn{
  from{opacity:0;transform:scale(.5)}
  to{opacity:1;transform:scale(1)}
}
.transition-screen h2{
  font-size:1.2rem;font-weight:800;color:var(--text);
  margin-bottom:12px;
}
.transition-screen p{color:var(--text-sub);font-size:.9rem;margin-bottom:24px}
.loading-dots{
  display:inline-flex;gap:6px;align-items:center;
  margin-top:8px;
}
.loading-dots span{
  width:8px;height:8px;border-radius:50%;
  background:var(--primary);opacity:.3;
  animation:dot-pulse 1.2s ease-in-out infinite;
}
.loading-dots span:nth-child(2){animation-delay:.2s}
.loading-dots span:nth-child(3){animation-delay:.4s}
@keyframes dot-pulse{
  0%,100%{opacity:.3;transform:scale(1)}
  50%{opacity:1;transform:scale(1.3)}
}

.retry-link{
  display:inline-flex;align-items:center;gap:6px;
  color:var(--text-sub);font-size:.8rem;
  cursor:pointer;background:none;border:none;
  margin-top:16px;text-decoration:underline;
}
.retry-link:hover{color:var(--primary)}

/* â”€â”€ Intro icons â”€â”€ */
.intro-icons{
  display:flex;justify-content:center;gap:12px;
  margin:24px 0 8px;flex-wrap:wrap;
}
.intro-icons span{
  display:inline-flex;align-items:center;gap:6px;
  padding:8px 16px;border-radius:60px;font-size:.82rem;font-weight:600;
  background:var(--surface2);border:1px solid var(--border);
}

/* â”€â”€ Responsive â”€â”€ */
@media(max-width:480px){
  header h1{font-size:1.25rem}
  .card{padding:24px 18px}
  .q-text{font-size:1.05rem}
  .opt-btn{padding:14px 16px;font-size:.88rem}
}
</style>
</head>
<body>

<div class="container">

  <header>
    <h1>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ“ã‚¸ãƒã‚¹<br>5ã¤ã®å‹ è¨ºæ–­</h1>
    <p>7ã¤ã®è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã«ã´ã£ãŸã‚Šã®å‹ãŒã‚ã‹ã‚‹</p>
  </header>

  <!-- ====== INTRO ====== -->
  <div id="intro" class="card screen">
    <p style="font-size:1.1rem;font-weight:700;margin-bottom:12px;color:var(--text)">ã‚ãªãŸã«åˆã£ãŸ<br>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ“ã‚¸ãƒã‚¹ã®å‹ã‚’è¨ºæ–­ï¼</p>
    <p style="color:var(--text-sub);font-size:.9rem">
      ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ“ã‚¸ãƒã‚¹ã«ã¯5ã¤ã®å‹ãŒã‚ã‚Šã¾ã™ã€‚<br>
      ã‚ãªãŸã®çµŒé¨“ãƒ»æ€§æ ¼ãƒ»ç›®æ¨™ã‹ã‚‰ã€<br>æœ€é©ãªå‹ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ã€‚
    </p>
    <div class="intro-icons">
      <span style="color:var(--reporter)">ğŸ“¡ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼å‹</span>
      <span style="color:var(--arbitrage)">ğŸŒ ã‚¢ãƒ¼ãƒ“ãƒˆãƒ©ãƒ¼ã‚¸å‹</span>
      <span style="color:var(--collab)">ğŸ¤ ã‚³ãƒ©ãƒœå‹</span>
      <span style="color:var(--prosumer)">ğŸ“š ãƒ—ãƒ­ã‚·ãƒ¥ãƒ¼ãƒãƒ¼å‹</span>
      <span style="color:var(--uber)">ğŸ“¦ ã‚¦ãƒ¼ãƒãƒ¼ã‚¤ãƒ¼ãƒ„å‹</span>
    </div>
    <button class="start-btn" onclick="startQuiz()">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ â†’</button>
    <p style="margin-top:16px;font-size:.75rem;color:var(--text-sub)">æ‰€è¦æ™‚é–“ï¼šç´„2åˆ† ï¼ å…¨7å•</p>
  </div>

  <!-- ====== PROGRESS ====== -->
  <div id="progress-section" class="progress-wrap hidden">
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="progress-label" class="progress-label"></div>
  </div>

  <!-- ====== QUESTION ====== -->
  <div id="question-card" class="card hidden"></div>

  <!-- ====== RESULT (transition) ====== -->
  <div id="result" class="card screen hidden"></div>

</div>

<script>
// â”€â”€ GAS endpoint for analytics (set after Google Apps Script deployment) â”€â”€
const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxuFasSFzxGpZoOnSjFlGFz9GWVapCQsKyH1M0hqv-7g20MpduXCOo2S8Z-wR1trk2H/exec';

const TYPES = {
  reporter:  {name:"ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼å‹",    emoji:"ğŸ“¡", color:"#DC2626"},
  arbitrage: {name:"ã‚¢ãƒ¼ãƒ“ãƒˆãƒ©ãƒ¼ã‚¸å‹", emoji:"ğŸŒ", color:"#0891B2"},
  collab:    {name:"ã‚³ãƒ©ãƒœå‹",        emoji:"ğŸ¤", color:"#D97706"},
  prosumer:  {name:"ãƒ—ãƒ­ã‚·ãƒ¥ãƒ¼ãƒãƒ¼å‹", emoji:"ğŸ“š", color:"#7C3AED"},
  uber:      {name:"ã‚¦ãƒ¼ãƒãƒ¼ã‚¤ãƒ¼ãƒ„å‹", emoji:"ğŸ“¦", color:"#DB2777"}
};

const QUESTIONS = [
  {
    text: "ä½•ã‹ã‚’é”æˆã—ãŸã¨ãã€ä¸€ç•ªã€Œã‚„ã£ãŸï¼ã€ã¨æ„Ÿã˜ã‚‹ç¬é–“ã¯ï¼Ÿ",
    opts: [
      {icon:"ğŸŒŠ", label:"ãƒãƒ©ãƒãƒ©ã ã£ãŸäººãŸã¡ãŒä¸€ã¤ã«ãªã£ã¦çµæœãŒå‡ºãŸã¨ã",              scores:{collab:3, reporter:1}},
      {icon:"âš¡", label:"è‡ªåˆ†ãŒä½œã£ãŸä»•çµ„ã¿ã§èª°ã‹ãŒè¿·ã‚ãšå‹•ã‘ãŸã¨ã",                    scores:{uber:3, arbitrage:1}},
      {icon:"ğŸŒŸ", label:"æ€ã„ãŒã‘ãšã€Œã‚ãªãŸã«èã„ã¦ã‚ˆã‹ã£ãŸã€ã¨è¨€ã‚ã‚ŒãŸã¨ã",            scores:{reporter:3, prosumer:1}},
      {icon:"ğŸ”¥", label:"å¤¢ä¸­ã§èª¿ã¹ã¦ã„ãŸã“ã¨ãŒã€ã´ã£ãŸã‚Šã¯ã¾ã‚‹å ´é¢ã«å‡ºä¼šãˆãŸã¨ã",      scores:{prosumer:3, collab:1}},
      {icon:"ğŸ¯", label:"ã¿ã‚“ãªã‚ˆã‚Šå…ˆã«æ°—ã¥ã„ã¦å‹•ã‘ã¦ã„ãŸã¨æ°—ã¥ã„ãŸã¨ã",                scores:{arbitrage:3, uber:1}}
    ]
  },
  {
    text: "ä»•äº‹ã‚„æ´»å‹•ã§ã€Œã“ã‚ŒãŒä¸€ç•ªå¤§äº‹ã€ã¨æ€ã†ã®ã¯ï¼Ÿ",
    opts: [
      {icon:"ğŸ“¦", label:"ç©ã¿ä¸Šã’ãŸçµŒé¨“ã‚’èª°ã§ã‚‚ä½¿ãˆã‚‹ã‹ãŸã¡ã«ã™ã‚‹ã“ã¨",                  scores:{uber:3, prosumer:1}},
      {icon:"ğŸŒº", label:"ä¸€ã¤ã®ã“ã¨ã‚’æ·±ãæ¥µã‚ã‚‹ã“ã¨",                                   scores:{prosumer:3, arbitrage:1}},
      {icon:"ğŸ’«", label:"äººã¨ã®å‡ºä¼šã„ã‚„ç¸ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨",                             scores:{reporter:3, collab:2}},
      {icon:"ğŸŒˆ", label:"ã¿ã‚“ãªãŒåŠ›ã‚’åˆã‚ã›ã‚‰ã‚Œã‚‹ç’°å¢ƒã‚’ã¤ãã‚‹ã“ã¨",                     scores:{collab:3, uber:1}},
      {icon:"ğŸ”ï¸", label:"å¸¸ã«æ–°ã—ã„æƒ…å ±ã‚„è¦–ç‚¹ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ç¶šã‘ã‚‹ã“ã¨",                scores:{arbitrage:3, reporter:1}}
    ]
  },
  {
    text: "ã‚°ãƒ«ãƒ¼ãƒ—ã§ä½•ã‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã™ã‚‹ã¨ãã€æ°—ã¥ã„ãŸã‚‰è‡ªç„¶ã¨ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ï¼Ÿ",
    opts: [
      {icon:"ğŸ—‚ï¸", label:"å½¹å‰²ã‚„æ‰‹é †ã‚’æ•´ç†ã—ã¦ãƒãƒ¼ãƒ ãŒå‹•ãã‚„ã™ãã™ã‚‹",                   scores:{uber:3, arbitrage:1}},
      {icon:"ğŸ”­", label:"å¤–ã®äº‹ä¾‹ã‚„èª°ã‚‚çŸ¥ã‚‰ãªã„æƒ…å ±ã‚’æŒã¡è¾¼ã‚€",                          scores:{arbitrage:3, prosumer:1}},
      {icon:"ğŸ’¡", label:"è‡ªåˆ†ã®å°‚é–€æ€§ã§å¾¹åº•çš„ã«ã‚µãƒãƒ¼ãƒˆã™ã‚‹",                           scores:{prosumer:3, uber:1}},
      {icon:"ğŸŒ", label:"è©³ã—ã„äººã‚„çµŒé¨“è€…ã‚’æ¢ã—ã¦ã¤ãªã",                               scores:{reporter:3, collab:2}},
      {icon:"ğŸµ", label:"ã¿ã‚“ãªã®æ„è¦‹ã‚’å¼•ãå‡ºã—ã¦æ•´ç†ã™ã‚‹",                             scores:{collab:3, reporter:1}}
    ]
  },
  {
    text: "æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã¨ãã€æœ€åˆã«è‡ªç„¶ã¨ã‚„ã‚‹ã“ã¨ã¯ï¼Ÿ",
    opts: [
      {icon:"ğŸ—ºï¸", label:"ã¾ãšå…ˆè¡Œäº‹ä¾‹ã‚’å¾¹åº•çš„ã«èª¿ã¹ã¦å…¨ä½“åƒã‚’æ´ã‚€",                    scores:{arbitrage:3, reporter:1}},
      {icon:"ğŸ¤²", label:"ä¸€ç·’ã«ã‚„ã‚Œã‚‹ä»²é–“ã‚„å”åŠ›è€…ã‚’æ¢ã™",                               scores:{collab:3, prosumer:1}},
      {icon:"ğŸ§­", label:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰é€†ç®—ã—ã¦æ‰‹é †ã‚’çµ„ã¿ç«‹ã¦ã‚‹",                           scores:{uber:3, arbitrage:1}},
      {icon:"ğŸ™ï¸", label:"çµŒé¨“è€…ã‚„é–¢ä¿‚è€…ã«è©±ã‚’èãã«è¡Œã",                               scores:{reporter:3, uber:1}},
      {icon:"ğŸ“–", label:"è‡ªåˆ†ã§ã¨ã“ã¨ã‚“å­¦ã‚“ã§ç†è§£ã—ã¦ã‹ã‚‰å‹•ã",                         scores:{prosumer:3, collab:1}}
    ]
  },
  {
    text: "è‡ªåˆ†ã®å¼·ã¿ã‚’ä¸€è¨€ã§è¡¨ã™ã¨ã—ãŸã‚‰ï¼Ÿ",
    opts: [
      {icon:"âš™ï¸", label:"è¤‡é›‘ãªã“ã¨ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å†ç¾ã§ãã‚‹å½¢ã«ã§ãã‚‹",                   scores:{uber:3, prosumer:1}},
      {icon:"ğŸ”¬", label:"æ°—ã«ãªã£ãŸã“ã¨ã‚’èª°ã‚ˆã‚Šã‚‚æ·±ãæ˜ã‚Šä¸‹ã’ã‚‰ã‚Œã‚‹",                   scores:{prosumer:3, arbitrage:1}},
      {icon:"ğŸŒŠ", label:"å‘¨ã‚Šã‚ˆã‚Šæ—©ãæµã‚Œã‚’èª­ã‚“ã§å‹•ã‘ã‚‹",                               scores:{arbitrage:3, uber:1}},
      {icon:"ğŸŒ‰", label:"äººã¨äººã‚’ã¤ãªã„ã§ã¾ã¨ã‚ã‚‹ã®ãŒå¾—æ„",                             scores:{collab:3, reporter:1}},
      {icon:"ğŸ¤", label:"äººã®è©±ã‚’å¼•ãå‡ºã™ã®ãŒã†ã¾ã„",                                  scores:{reporter:3, collab:2}}
    ]
  },
  {
    text: "å¥½ããªæƒ…å ±ã®é›†ã‚æ–¹ã«è¿‘ã„ã®ã¯ï¼Ÿ",
    opts: [
      {icon:"ğŸŒ³", label:"ä¸€ã¤ã®ã‚¸ãƒ£ãƒ³ãƒ«ã‚’æ·±æ˜ã‚Šã—ã¦é–¢é€£æƒ…å ±ã‚’ç¶²ç¾…ã™ã‚‹",                  scores:{prosumer:3, collab:1}},
      {icon:"ğŸ”—", label:"ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ä»²é–“ã®ç™ºä¿¡ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦å…±æœ‰ã™ã‚‹",                scores:{collab:3, uber:1}},
      {icon:"ğŸ¦…", label:"ã¾ã å¤šãã®äººãŒçŸ¥ã‚‰ãªã„æƒ…å ±ã‚’è‡ªåˆ†ã‹ã‚‰å–ã‚Šã«ã„ã",               scores:{arbitrage:3, reporter:1}},
      {icon:"ğŸ“", label:"ä½“ç³»çš„ã«å­¦ã¹ã‚‹è¬›åº§ã‚„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã§å­¦ã¶",                       scores:{uber:3, arbitrage:1}},
      {icon:"â˜•", label:"æ°—ã«ãªã£ãŸäººã«ç›´æ¥ä¼šã£ã¦ã€è©±ã‹ã‚‰å­¦ã¶",                         scores:{reporter:3, prosumer:1}}
    ]
  },
  {
    text: "è‡ªåˆ†ãŒç™ºä¿¡ã™ã‚‹ãªã‚‰ã€ã©ã‚“ãªã‚¹ã‚¿ã‚¤ãƒ«ãŒä¸€ç•ªã—ã£ãã‚Šãã‚‹ï¼Ÿ",
    opts: [
      {icon:"ğŸ“‹", label:"èª°ã§ã‚‚å†ç¾ã§ãã‚‹ã‚ˆã†æ‰‹é †ã‚„ãƒã‚¤ãƒ³ãƒˆã‚’æ•´ç†ã—ã¦ä¼ãˆã‚‹",            scores:{uber:3, collab:1}},
      {icon:"ğŸ¬", label:"å®Ÿéš›ã«ä¼šã£ã¦è©±ã—ãŸäººã®ãƒªã‚¢ãƒ«ãªè©±ã‚’å±Šã‘ã‚‹",                     scores:{reporter:3, collab:1}},
      {icon:"ğŸ““", label:"è‡ªåˆ†ã®çµŒé¨“ã‚„å­¦ã³ã‚’ãƒªã‚¢ãƒ«ã«è¨˜éŒ²ã—ãªãŒã‚‰å±Šã‘ã‚‹",                 scores:{prosumer:3, uber:1}},
      {icon:"ğŸŒ", label:"ã¾ã æ³¨ç›®ã•ã‚Œã¦ã„ãªã„æƒ…å ±ã‚’ã„ã¡æ—©ãå±Šã‘ã‚‹",                     scores:{arbitrage:3, prosumer:1}},
      {icon:"ğŸª", label:"è‡ªåˆ†ä¸€äººã§ã¯ãªãã€èª°ã‹ã¨ä¸€ç·’ã«ä½œã‚Šä¸Šã’ã‚‹",                    scores:{collab:3, reporter:1}}
    ]
  }
];

let currentQ = 0;
let currentShuffled = [];
const scores = {reporter:0, arbitrage:0, collab:0, prosumer:0, uber:0};

function $(id){return document.getElementById(id)}

function startQuiz(){
  $("intro").classList.add("hidden");
  $("progress-section").classList.remove("hidden");
  showQuestion();
}

function showQuestion(){
  const q = QUESTIONS[currentQ];
  const total = QUESTIONS.length;
  $("progress-fill").style.width = ((currentQ)/total*100)+"%";
  $("progress-label").textContent = `${currentQ+1} / ${total}`;

  // Shuffle options for display (scores stay attached to each option object)
  currentShuffled = [...q.opts].sort(() => Math.random() - 0.5);

  const card = $("question-card");
  card.classList.remove("hidden");
  card.style.animation = "none";
  void card.offsetWidth;
  card.style.animation = "";

  let html = `<div class="q-number">Question ${currentQ+1}</div>`;
  html += `<div class="q-text">${q.text}</div>`;
  html += `<div class="options">`;
  currentShuffled.forEach((o,i) => {
    html += `<button class="opt-btn" onclick="answer(${i})">
      <span class="icon">${o.icon}</span><span>${o.label}</span>
    </button>`;
  });
  html += `</div>`;
  card.innerHTML = html;
}

function answer(idx){
  // Use shuffled order to get scores
  const chosen = currentShuffled[idx].scores;
  for(const k in chosen) scores[k] += chosen[k];

  currentQ++;
  if(currentQ < QUESTIONS.length){
    showQuestion();
  } else {
    showResult();
  }
}

function saveProfile(type, allScores){
  const profile = JSON.parse(localStorage.getItem('cbProfile') || '{"quizzes":{}}');
  profile.quizzes = profile.quizzes || {};
  profile.quizzes.v1 = {
    type: type,
    scores: {...allScores},
    timestamp: new Date().toISOString()
  };
  profile.primaryType = type;
  localStorage.setItem('cbProfile', JSON.stringify(profile));
}

function sendToGAS(type, allScores){
  if(!GAS_ENDPOINT) return;
  try {
    fetch(GAS_ENDPOINT, {
      method: 'POST',
      mode: 'no-cors',
      body: JSON.stringify({
        type: type,
        scores: allScores,
        ua: navigator.userAgent.substring(0, 200),
        ref: document.referrer.substring(0, 200)
      })
    });
  } catch(e){}
}

function showResult(){
  $("question-card").classList.add("hidden");
  $("progress-fill").style.width = "100%";
  $("progress-label").textContent = "å®Œäº†ï¼";

  const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const topKey = sorted[0][0];

  saveProfile(topKey, scores);
  sendToGAS(topKey, scores);

  const card = $("result");
  card.classList.remove("hidden");
  card.style.animation = "none";
  void card.offsetWidth;
  card.style.animation = "";

  card.innerHTML = `
    <div class="transition-screen">
      <div class="check">âœ…</div>
      <h2>è¨ºæ–­ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h2>
      <p>ã‚ãªãŸã®å‹ã«åˆã‚ã›ãŸ<br>ç‰¹åˆ¥ãªãƒšãƒ¼ã‚¸ã‚’ã”ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚</p>
      <div class="loading-dots">
        <span></span><span></span><span></span>
      </div>
      <br>
      <button class="retry-link" onclick="retry()">ğŸ”„ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
    </div>
  `;

  // Auto-redirect after 1.5s
  setTimeout(() => {
    window.location.href = './lp/';
  }, 1500);
}

function retry(){
  currentQ = 0;
  currentShuffled = [];
  for(const k in scores) scores[k] = 0;
  $("result").classList.add("hidden");
  $("result").innerHTML = "";
  $("progress-fill").style.width = "0%";
  $("progress-label").textContent = "";
  showQuestion();
}
</script>
</body>
</html>
